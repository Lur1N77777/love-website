<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘ä»¬çš„æ‹çˆ±å°å±‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Lxgw+WenKai+Lite:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #FFF0F5; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23FBCFE8' fill-opacity='0.4'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            -webkit-tap-highlight-color: transparent;
        }
        .font-chinese { font-family: 'LXGW WenKai Lite', cursive; }
        .bg-macaron-pink { background-color: #F8C8DC; }
        .bg-macaron-blue { background-color: #A2D2FF; }
        .bg-macaron-yellow { background-color: #FCF3CF; }
        .bg-macaron-green { background-color: #BDE0FE; }
        .text-macaron-brown { color: #8d6e63; }
        .border-macaron-pink { border-color: #F8C8DC; }
        .border-macaron-blue { border-color: #A2D2FF; }
        .border-macaron-green { border-color: #BDE0FE; }
        .bg-warm-white { background-color: #FFFCF9; }
        .bg-soft-pink-glass { background-color: rgba(255, 240, 245, 0.8); }
        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-bg { background-color: rgba(0, 0, 0, 0.5); }
        .diary-image { max-height: 300px; object-fit: cover; }
        /* æŒ‰é’®ç¦ç”¨æ—¶çš„æ ·å¼ */
        .btn-disabled {
            cursor: not-allowed;
            background-color: #d1d5db; /* gray-300 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- ç™»å½•é®ç½©å±‚ -->
    <div id="login-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-bg transition-opacity duration-300">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center w-11/12 max-w-sm">
            <h2 class="text-3xl font-bold text-macaron-brown font-chinese mb-4">è¿›å…¥æˆ‘ä»¬çš„çˆ±å·¢</h2>
            <p class="text-gray-500 mb-6">è¯·é€‰æ‹©ä½ çš„èº«ä»½~</p>
            <div class="space-y-4">
                <button onclick="showPasswordPrompt('her')" class="w-full bg-macaron-pink text-white py-3 rounded-xl font-bold text-lg hover:bg-opacity-80 transition-all duration-300 transform hover:scale-105">æˆ‘æ˜¯å¥³ç”Ÿ</button>
                <button onclick="showPasswordPrompt('him')" class="w-full bg-macaron-blue text-white py-3 rounded-xl font-bold text-lg hover:bg-opacity-80 transition-all duration-300 transform hover:scale-105">æˆ‘æ˜¯ç”·ç”Ÿ</button>
            </div>
        </div>
    </div>
    
    <!-- å¯†ç è¾“å…¥å¼¹çª— (é»˜è®¤éšè—) -->
    <div id="password-prompt" class="fixed inset-0 z-50 hidden items-center justify-center modal-bg transition-opacity duration-300">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center w-11/11 max-w-sm">
            <h2 id="password-title" class="text-2xl font-bold text-macaron-brown font-chinese mb-4"></h2>
            <p class="text-gray-500 mb-6">è¯·è¾“å…¥ä½ çš„ç”Ÿæ—¥ä½œä¸ºå¯†ç  (æ ¼å¼: MMDD, å¦‚0101)</p>
            <input type="password" id="password-input" class="w-full border-2 border-gray-200 p-3 rounded-lg text-center text-lg focus:outline-none focus:border-macaron-pink" placeholder="MMDD">
            <p id="error-message" class="text-red-500 mt-2 h-4"></p>
            <div class="flex gap-4 mt-4">
                <button onclick="hidePasswordPrompt()" class="w-full bg-gray-300 text-gray-700 py-2 rounded-xl hover:bg-gray-400 transition-colors">è¿”å›</button>
                <button onclick="checkPassword()" class="w-full bg-macaron-pink text-white py-2 rounded-xl hover:bg-opacity-80 transition-colors">ç¡®è®¤</button>
            </div>
        </div>
    </div>


    <!-- ä¸»å†…å®¹åŒº (é»˜è®¤éšè—) -->
    <main id="main-content" class="hidden w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-soft-pink-glass backdrop-blur-sm rounded-3xl shadow-lg p-6 md:p-10 space-y-8 fade-in">
            <!-- å¤´éƒ¨ -->
            <header class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-macaron-brown font-chinese">ğŸ’– æˆ‘ä»¬çš„æ‹çˆ±å°å±‹ ğŸ’–</h1>
                <p class="text-gray-500 mt-2">è®°å½•æˆ‘ä»¬åœ¨ä¸€èµ·çš„æ¯åˆ†æ¯ç§’</p>
            </header>

            <!-- æ‹çˆ±è®¡æ—¶å™¨ (äº‘ç«¯åŒæ­¥) -->
            <section id="love-timer" class="bg-macaron-yellow p-6 rounded-2xl shadow-md text-center">
                 <h2 class="text-xl font-bold text-macaron-brown mb-4 font-chinese flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-macaron-brown"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    æˆ‘ä»¬å·²ç»ç›¸çˆ±äº†
                </h2>
                <div id="timer-display" class="flex justify-center items-center space-x-2 md:space-x-4 text-macaron-brown">
                    <div class="text-center"><span id="days" class="text-4xl md:text-6xl font-bold">0</span><p class="text-sm">å¤©</p></div>
                    <div class="text-4xl md:text-6xl font-bold">:</div>
                    <div class="text-center"><span id="hours" class="text-4xl md:text-6xl font-bold">0</span><p class="text-sm">æ—¶</p></div>
                    <div class="text-4xl md:text-6xl font-bold">:</div>
                    <div class="text-center"><span id="minutes" class="text-4xl md:text-6xl font-bold">0</span><p class="text-sm">åˆ†</p></div>
                    <div class="text-4xl md:text-6xl font-bold">:</div>
                    <div class="text-center"><span id="seconds" class="text-4xl md:text-6xl font-bold">0</span><p class="text-sm">ç§’</p></div>
                </div>
                <div class="mt-4 text-gray-500 text-sm">
                    å§‹äº: <span id="start-date-display">...</span>
                </div>
                <button onclick="toggleSetDate()" class="mt-4 bg-white text-macaron-brown px-4 py-2 rounded-lg shadow-sm hover:bg-gray-50 transition">è®¾ç½®/ä¿®æ”¹çºªå¿µæ—¥</button>
                <div id="date-setter" class="hidden mt-4 space-y-2 max-w-sm mx-auto">
                    <input type="datetime-local" id="love-start-date" class="w-full border-2 border-gray-200 p-2 rounded-lg focus:outline-none focus:border-macaron-blue">
                    <button onclick="setLoveStartDate()" class="w-full bg-macaron-blue text-white py-2 rounded-lg hover:bg-opacity-80 transition">ä¿å­˜</button>
                </div>
            </section>

            <!-- æ‹çˆ±æ—¥è®° -->
            <section id="love-diary">
                <h2 class="text-2xl font-bold text-macaron-brown text-center mb-6 font-chinese flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-macaron-brown"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    æˆ‘ä»¬çš„ç”œèœœæ—¥è®°
                </h2>
                
                <div class="bg-warm-white p-6 rounded-2xl shadow-md mb-8">
                    <h3 class="font-bold text-lg mb-4 text-macaron-brown font-chinese">å†™ä¸‹ä»Šå¤©çš„æ•…äº‹...</h3>
                    <textarea id="diary-text" rows="4" class="w-full border-2 border-gray-200 p-3 rounded-lg focus:outline-none focus:border-macaron-green" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆæœ‰è¶£çš„äº‹å‘¢ï¼Ÿ"></textarea>
                    
                    <input type="file" id="diary-image-upload" class="hidden" accept="image/*" onchange="previewImage(event)">
                    
                    <div id="image-preview-container" class="hidden mt-4 text-center">
                        <img id="image-preview" src="" alt="å›¾ç‰‡é¢„è§ˆ" class="max-h-40 mx-auto rounded-lg">
                        <button onclick="removeImage()" class="mt-2 text-red-500 text-sm">åˆ é™¤å›¾ç‰‡</button>
                    </div>

                    <div class="flex justify-between items-center mt-4">
                        <button onclick="triggerFileUpload()" title="æ·»åŠ å›¾ç‰‡" class="bg-macaron-pink text-white w-12 h-12 flex items-center justify-center rounded-full hover:bg-opacity-80 transition transform hover:scale-110">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>
                        </button>
                        <button id="publish-btn" onclick="addDiaryEntry()" class="bg-macaron-green text-white py-3 px-8 rounded-xl font-bold hover:bg-opacity-80 transition-all duration-300 transform hover:scale-105">å‘å¸ƒæ—¥è®°</button>
                    </div>
                </div>

                <div id="diary-entries" class="space-y-6">
                    <!-- æ—¥è®°æ¡ç›®ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </section>
        </div>
    </main>

    <!-- Firebase å’Œ ImgBB é›†æˆ -->
    <script type="module">
        // å¼•å…¥ Firebase æœåŠ¡
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // ===================================================================================
        // ======================== ğŸ”¥ ä½ çš„ä¸“å±é…ç½®å·²å¡«å……å®Œæ¯• ğŸ”¥ ========================
        // ===================================================================================

        const firebaseConfig = {
            apiKey: "AIzaSyDkRSccHy4XPTmTzZ4E4jx0xXQXjlsVFrk",
            authDomain: "love-website-34385.firebaseapp.com",
            projectId: "love-website-34385",
            storageBucket: "love-website-34385.firebasestorage.app",
            messagingSenderId: "109172560935",
            appId: "1:109172560935:web:e7fc9a5431e9e2d4f9ea02",
            measurementId: "G-ZWZGWYNSDK"
        };
        
        const imgbbApiKey = '52d9ae954fb6ac2768c4f8384cc51c36';

        // ===================================================================================
        // ===================================================================================

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- å…¨å±€å˜é‡å’Œ DOM å…ƒç´  ---
        const passwords = { her: '1205', him: '0805' };
        let currentUser = null;
        let selectedFile = null;

        const loginModal = document.getElementById('login-modal');
        const passwordPrompt = document.getElementById('password-prompt');
        const mainContent = document.getElementById('main-content');
        const diaryText = document.getElementById('diary-text');
        const diaryImageUpload = document.getElementById('diary-image-upload');
        const diaryEntriesContainer = document.getElementById('diary-entries');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const publishBtn = document.getElementById('publish-btn');
        
        // --- å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä»¥ä¾¿ HTML onclick å¯ä»¥è°ƒç”¨ ---
        window.showPasswordPrompt = showPasswordPrompt;
        window.hidePasswordPrompt = hidePasswordPrompt;
        window.checkPassword = checkPassword;
        window.toggleSetDate = toggleSetDate;
        window.setLoveStartDate = setLoveStartDate;
        window.triggerFileUpload = triggerFileUpload;
        window.previewImage = previewImage;
        window.removeImage = removeImage;
        window.addDiaryEntry = addDiaryEntry;
        window.deleteDiaryEntry = deleteDiaryEntry;

        // --- ç™»å½•ä¸è®¤è¯ ---
        // é¡µé¢åŠ è½½æ—¶ï¼Œè‡ªåŠ¨è¿›è¡ŒåŒ¿åç™»å½•ä»¥å»ºç«‹ç¨³å®šè¿æ¥
        signInAnonymously(auth).catch((error) => {
            console.error("Anonymous sign-in failed:", error);
            alert("æ— æ³•å»ºç«‹å®‰å…¨çš„äº‘ç«¯è¿æ¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå¹¶åˆ·æ–°é¡µé¢ã€‚");
        });

        // ç›‘å¬è®¤è¯çŠ¶æ€
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Authenticated anonymously with UID:", user.uid);
                // è®¤è¯æˆåŠŸï¼Œä½†UIä»ç”±å¯†ç æ§åˆ¶
            }
        });

        function showPasswordPrompt(user) {
            currentUser = user;
            document.getElementById('password-title').textContent = user === 'her' ? 'æ¬¢è¿å°ä¸€äºŒå›å®¶' : 'æ¬¢è¿å°å¸ƒå¸ƒå›å®¶';
            passwordPrompt.style.display = 'flex';
        }

        function hidePasswordPrompt() {
            passwordPrompt.style.display = 'none';
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password-input');
            const errorMessage = document.getElementById('error-message');
            if (passwordInput.value === passwords[currentUser]) {
                loginModal.style.display = 'none';
                passwordPrompt.style.display = 'none';
                mainContent.style.display = 'block';
                initApp(); // è®¤è¯æˆåŠŸååˆå§‹åŒ–åº”ç”¨
            } else {
                errorMessage.textContent = 'å¯†ç ä¸å¯¹å“¦ï¼Œå†æƒ³æƒ³~';
                setTimeout(() => { errorMessage.textContent = ''; }, 2000);
            }
        }

        // --- åˆå§‹åŒ–åº”ç”¨ ---
        function initApp() {
            listenForDateUpdates(); // æ›¿æ¢æœ¬åœ°åŠ è½½
            listenForDiaryUpdates();
        }

        // --- å›¾ç‰‡ä¸Šä¼ åˆ° ImgBB ---
        async function uploadImageToImgBB(file) {
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
                    method: 'POST',
                    body: formData,
                });
                const result = await response.json();
                if (result.success) {
                    return result.data.url;
                } else {
                    console.error('ImgBB upload failed:', result);
                    throw new Error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('å›¾ç‰‡ä¸Šä¼ æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚');
                return null;
            }
        }

        // --- æ—¥è®° Firestore é€»è¾‘ ---
        async function addDiaryEntry() {
            const text = diaryText.value.trim();
            if (!text && !selectedFile) {
                alert('æ—¥è®°å†…å®¹å’Œå›¾ç‰‡è‡³å°‘è¦æœ‰ä¸€ä¸ªå“¦ï¼');
                return;
            }
            publishBtn.disabled = true;
            publishBtn.textContent = 'å‘å¸ƒä¸­...';
            publishBtn.classList.add('btn-disabled');

            let imageUrl = null;
            if (selectedFile) {
                imageUrl = await uploadImageToImgBB(selectedFile);
                if (!imageUrl) {
                    publishBtn.disabled = false;
                    publishBtn.textContent = 'å‘å¸ƒæ—¥è®°';
                    publishBtn.classList.remove('btn-disabled');
                    return;
                }
            }
            try {
                await addDoc(collection(db, "diaries"), {
                    text: text,
                    imageUrl: imageUrl,
                    author: currentUser,
                    timestamp: serverTimestamp()
                });
                diaryText.value = '';
                removeImage();
            } catch (error) {
                console.error("Error adding document: ", error);
                alert('å‘å¸ƒæ—¥è®°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
            } finally {
                publishBtn.disabled = false;
                publishBtn.textContent = 'å‘å¸ƒæ—¥è®°';
                publishBtn.classList.remove('btn-disabled');
            }
        }

        function listenForDiaryUpdates() {
            const q = query(collection(db, "diaries"), orderBy("timestamp", "desc"));
            onSnapshot(q, (querySnapshot) => {
                const entries = [];
                querySnapshot.forEach((doc) => {
                    entries.push({ id: doc.id, ...doc.data() });
                });
                renderDiary(entries);
            });
        }
        
        async function deleteDiaryEntry(id) {
             if(confirm('çœŸçš„è¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿè¿™ä¼šä»äº‘ç«¯æ°¸ä¹…åˆ é™¤å“¦ï¼')) {
                try {
                    await deleteDoc(doc(db, "diaries", id));
                } catch(error) {
                    console.error("Error deleting document: ", error);
                    alert("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚");
                }
            }
        }

        function renderDiary(entries) {
            diaryEntriesContainer.innerHTML = '';
            if (entries.length === 0) {
                diaryEntriesContainer.innerHTML = `<div class="text-center text-gray-400 py-8 font-chinese">è¿˜æ²¡æœ‰æ—¥è®°å‘¢ï¼Œå¿«æ¥å†™ä¸‹ç¬¬ä¸€ç¯‡å§ï¼</div>`;
                return;
            }
            entries.forEach(entry => {
                const entryEl = document.createElement('div');
                const isHer = entry.author === 'her';
                const authorInfo = isHer
                    ? { name: 'å°ä¸€äºŒ', icon: 'ğŸ‘‘', borderColor: 'border-macaron-pink' }
                    : { name: 'å°å¸ƒå¸ƒ', icon: 'ğŸ›¡ï¸', borderColor: 'border-macaron-blue' };

                entryEl.className = `bg-warm-white p-5 rounded-2xl shadow-md fade-in border-l-4 ${authorInfo.borderColor}`;
                
                const date = entry.timestamp ? entry.timestamp.toDate() : new Date();
                const timeString = date.toLocaleString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                const imageHtml = entry.imageUrl ? `<img src="${entry.imageUrl}" alt="æ—¥è®°å›¾ç‰‡" class="mt-4 rounded-lg w-full diary-image">` : '';

                entryEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                             <div class="flex items-center gap-2">
                                <span class="text-xl">${authorInfo.icon}</span>
                                <span class="font-bold text-macaron-brown font-chinese text-lg">${authorInfo.name}çš„æ—¥è®°</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1 ml-2">${timeString}</p>
                        </div>
                        <button onclick="deleteDiaryEntry('${entry.id}')" class="text-gray-400 hover:text-red-500 text-2xl font-bold">&times;</button>
                    </div>
                    <p class="text-gray-800 mt-4 whitespace-pre-wrap pl-2">${entry.text || ''}</p>
                    ${imageHtml}
                `;
                diaryEntriesContainer.appendChild(entryEl);
            });
        }

        // --- å›¾ç‰‡é¢„è§ˆé€»è¾‘ ---
        function triggerFileUpload() { diaryImageUpload.click(); }
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        function removeImage() {
            selectedFile = null;
            diaryImageUpload.value = '';
            imagePreview.src = '';
            imagePreviewContainer.classList.add('hidden');
        }

        // --- è®¡æ—¶å™¨é€»è¾‘ (äº‘ç«¯åŒæ­¥) ---
        let loveStartDate;
        let timerInterval;
        const settingsDocRef = doc(db, "settings", "loveInfo");

        function listenForDateUpdates() {
            onSnapshot(settingsDocRef, (docSnap) => {
                let startDateISO;
                if (docSnap.exists()) {
                    startDateISO = docSnap.data().startDate;
                }
                // å¦‚æœäº‘ç«¯æ²¡æœ‰è®¾ç½®ï¼Œæˆ–è®¾ç½®æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤æ—¥æœŸ
                loveStartDate = startDateISO ? new Date(startDateISO) : new Date('2023-01-01T00:00:00');
                startLoveTimer();
            });
        }

        async function setLoveStartDate() {
            const dateValue = document.getElementById('love-start-date').value;
            if (dateValue) {
                const newStartDate = new Date(dateValue);
                try {
                    await setDoc(settingsDocRef, { startDate: newStartDate.toISOString() });
                    // onSnapshotä¼šè‡ªåŠ¨æ›´æ–°UIï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦å…³é—­è¾“å…¥æ¡†
                    toggleSetDate();
                } catch (error) {
                    console.error("Error saving start date: ", error);
                    alert("ä¿å­˜çºªå¿µæ—¥å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚");
                }
            }
        }

        function startLoveTimer() {
            if (timerInterval) clearInterval(timerInterval);
            if (!loveStartDate) return;
            
            const update = () => {
                const now = new Date();
                const diff = now - loveStartDate;
                document.getElementById('days').textContent = Math.floor(diff / 864e5);
                document.getElementById('hours').textContent = String(Math.floor((diff % 864e5) / 36e5)).padStart(2, '0');
                document.getElementById('minutes').textContent = String(Math.floor((diff % 36e5) / 6e4)).padStart(2, '0');
                document.getElementById('seconds').textContent = String(Math.floor((diff % 6e4) / 1e3)).padStart(2, '0');
            };
            update();
            timerInterval = setInterval(update, 1000);
            document.getElementById('start-date-display').textContent = loveStartDate.toLocaleString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }
        
        function toggleSetDate() { 
            document.getElementById('date-setter').classList.toggle('hidden'); 
        }

    </script>
</body>
</html>

